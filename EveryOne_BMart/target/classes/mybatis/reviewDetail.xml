<?xml version="1.0" encoding="UTF-8"?>

<!-- reviewDetail.xml -->
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reviewDetail">
	<select id="getReviewDetailCount" resultType="int">
		select count(*) 
		from ( select r.rnum, r.pnum, r.image, r.score, r.id, p.pname, r.rcomment, r.rdate from review r join product p on r.pnum=p.pnum) 
		where pnum=#{pnum} 
		<if test="range == 'recently'">
			order by rnum desc
		</if>
		<if test="range == 'highScore'">
			order by score desc
		</if>
		<if test="range == 'rowScore'">
			order by score
		</if>
	</select>
	
	<select id="getReviewDetail" resultType="reviewDetail">
		select *
		from ( select r.rnum, r.pnum, r.image, r.score, r.id, p.pname, r.rcomment, r.rdate from review r join product p on r.pnum=p.pnum) 
		where pnum=#{pnum} 
		<if test="range == 'recently'">
			order by rnum desc
		</if>
		<if test="range == 'highScore'">
			order by score desc
		</if>
		<if test="range == 'rowScore'">
			order by score
		</if>
	</select>
	
	<select id="getReviewCountById" resultType="int">
		select count(*) 
		from ( select r.rnum, r.pnum, r.image, r.score, r.id, p.pname, r.rcomment, r.rdate from review r join product p on r.pnum=p.pnum) 
		where id=#{id} order by rdate desc
	</select>
	
	<select id="getReviewById" resultType="reviewDetail">
		select * 
		from ( select r.rnum, r.pnum, r.image, r.score, r.id, p.pname, r.rcomment, r.rdate from review r join product p on r.pnum=p.pnum) 
		where id=#{id} order by rdate desc
	</select>
	
	<select id="getReviewDetailByRnum" resultType="reviewDetail">
		select * 
		from ( select r.rnum, r.pnum, r.image, r.score, r.id, p.pname, r.rcomment, r.rdate from review r join product p on r.pnum=p.pnum) 
		where rnum=#{rnum}
	</select>
</mapper>